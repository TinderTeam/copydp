<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8"/>

<title>笑谣林</title>
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1,user-scalable=no"/>
<link rel="stylesheet" href="__PUBLIC__/css/cssnew/newhome/list-new.min.1cea6629ab1ef98647074215ab384f52.css" type="text/css" />
<link rel="stylesheet" href="__PUBLIC__/css/cssnew/newhome/new-detail.min.a8caab113457f7a2093fedfdb0a8dbe6.css" type="text/css" />
<!-- <link rel="stylesheet" href="http://t1.s2.dpfile.com/t/cssnew/newhome/list-new.min.1cea6629ab1ef98647074215ab384f52.css" type="text/css"/>
<link type="text/css" href="http://t1.s2.dpfile.com/t/cssnew/deal/new-detail.min.a8caab113457f7a2093fedfdb0a8dbe6.css" rel="stylesheet"/> -->
	<style type="text/css">
		#allmap{width:100%;height:500px;}	
	</style>
	
	<!---地图声明---->
		<include file="./Home/Tpl/Public/map.html"/>
	<!---地图声明---->
	<script type="text/javascript" src="__PUBLIC__/js/jquery-1.11.1.min.js"></script>
	<script type="text/javascript" src="__PUBLIC__/js/jquery.qrcode.min.js"></script>

</head>
<body id="body" data-type="">
	<!---标题栏---->
		<include file="./Home/Tpl/Public/header.html"/>
	<!---标题栏---->
	
	<div class="head responsive">
		<!---Logo栏---->
			<include file="./Home/Tpl/Public/logobar.html"/>
		<!---Logo栏---->
		
		<div class="nav-bar">
			<div class="cont">
			
				<!-----主菜单---->
					<include file="./Home/Tpl/Public/menu2.html"/>
				<!-----主菜单---->
			</div>
		</div>
	</div>
	
	
	<?php
		$sellerViewDB=new Model('view_seller');
		$sellerIDCondition['user_id']=$sellerID;
		$sellerName=$sellerViewDB->where($sellerIDCondition)->getField('seller_name');
		$sellerDscr=$sellerViewDB->where($sellerIDCondition)->getField('description');
		$sellerhtml=$sellerViewDB->where($sellerIDCondition)->getField('info');
		$sellerImgsrc=$sellerViewDB->where($sellerIDCondition)->getField('img');
		$sellerPosition=$sellerViewDB->where($sellerIDCondition)->getField('position');
		$city=$sellerViewDB->where($sellerIDCondition)->getField('city');
		$type=$sellerViewDB->where($sellerIDCondition)->getField('type_name');
		$zone_name=$sellerViewDB->where($sellerIDCondition)->getField('zone_name');
	?>
	
	<!----主界面---->
	<div class="pgm">
		<div class="main_w page-index normal-type">
			<div class="summary summary-comments-big J_summary Fix" style="height: 300px;">
				<div class="no-book">
				</div>
				<div class="bd">
					<h1 class="title">{$sellerName}</h1>
					<h2 class="sub-title"> <span>{$sellerDscr}</span> </h2>
					<div class="action-box">
						<table class="action-blk">
							<tr>
								<td>
									<div class="action-info" style="text-align:left;">										
										<span>所在城市：{$city} </span>
									</div>
								</td>								
							</tr>
							<tr>
								<td>
									<div class="action-info" style="text-align:left;">										
										<span>所在区域：{$zone_name}</span>
									</div>
								</td>								
							</tr>
							<tr>
								<td>
									<div class="action-info" style="text-align:left;">										
										<span> 商户类型：{$type}</span>
									</div>
								</td>			
							</tr>		
						</table>
					</div>	
				<div class="action-box">
						<table class="action-blk">
							<tr>
								<td>
									<div class="action-info" style="text-align:left;">
										<?php
											$sellerEvaDB=new Model('seller_evaluation');
											$sellerEvaSellerIDCondition['seller_id']=$sellerID;
											$numberSellerEva=$sellerEvaDB->where($sellerEvaSellerIDCondition)->count();										
										?>
										<span> <a> {$numberSellerEva}</a>条商户评价 </span>
									</div>
								</td>							
							</tr>
						</table>
					</div>						
				</div>				
				<div class="lbd">
					<div class="img-area">
						<div class="slider" style="height: 280px;">
							<div class="slide J_switch J_switch_carousel imgloading">
								<div class="img-wrap J_wrap">
									<img  src="__PUBLIC__/uploads/img/{$sellerImgsrc}" >
								</div>							
							</div>
						</div>
					</div>
				</div>
			</div>
			

			<div class="content">
				<div class="other-deal-box">
					<div class="tit">
						<h3>商家产品</h3>
					</div>
					<?php
						$productViewDB=new Model('view_product');
						$productViewCondition['seller_id']=$sellerID;
						$procuctIDList=$productViewDB->where($productViewCondition)->select();		
					?>
					<volist name="procuctIDList" id="product">
						<div class="cont">
							<ul class="other-deal-list">
								<li > 
									<a class="Fix" href="__APP__/Buy/product_info?productID={$product['product_id']}" >
										<span class="price Price-font">&#165;{$product["price"]}</span>
										<span class="infor">{$product["name"]}:{$product["dscr"]}</span>
									</a>
								</li>
							</ul>
						</div>
					</volist>
				</div>
				<div class="box content J_tab_container">
					<div class="box Tabs-box switch-box">
						<div class="box-wrap">
							<div id="J_tab_mod" data-id="tab_mod">
															
							<!--二维码-->
							<?php				
								$sellerdb = M('seller');
								$sellerIDCondition['user_id']=$sellerID;
								$seller = $sellerdb->where($sellerIDCondition)->find();
								$codeFlag= $seller['qr_code'];			
							?>
								<ul class="switch-Tabs Fix J_Tabs" id="bodyTab" data-id="tab_list">
									<if condition="$codeFlag eq 'true'">
										<li class="new"> <a href="#qr"><span>二维码</span></a> </li>
									</if>	
									<li class="new"> <a href="#seller"><span>商家介绍</span></a> </li>
									<li class="new"> <a href="#map"><span>在线地图</span></a> </li>
									<li class="new"> <a href="#evaluation"><span>商户评价</span></a> </li>
								</ul>
							</div>
							<div class="box-cont tradingQA Fix" id="J_tabcont" data-id="J_tab_content">
								<div class="dptg-intro Fix">
									<if condition="$codeFlag eq 'true'">
										<div id="qr" class="detail">	
											<div class="um-con" id="myEvaluation">
												<div class="modebox my-comm J_my_comm" >
													<div class="hd">
														<h4>二维码</h4>			
													</div>
													<div class="con">
														<div class="">
														<?php
															$qrcode='{"type":"sellerID","value":"'.$sellerID.'"}';
														?>
														<!--<div id="output" data="{'type':'sellerID','value':'{$userID}'}"></div>	-->
															<div id="output" data='{$qrcode}'></div>		
														</div>				
													</div>
												</div>
											</div>
										</div>	
									</if>													
									<div id="seller" class="detail">
										<h3 class="new-tit"><span class="name">商家介绍</span></h3>
										<?php

											$sellerhtml=str_replace("\\", '', $sellerhtml);											
										?>
										<p class="explain">{$sellerhtml}</p>										
									</div>									
									<div class="detail">
										<p id ="position" data="{$sellerPosition}"></p>
										<p id ="city" data="{$city}"></p>
										<h3 id="map" class="new-tit"><span class="name">在线地图</span></h3>	
										<div id="allmap" class="img map"></div>
									</div>
									<!-- movie info end -->
									<div class="detail J_tab J_loadTab">
										<div class="comment-tab J_comment_tab">
											<span id="evaluation" class="tab-item cur" data-ref="J_site_comment"> <a >商户评价<em class="Hide J_total_count"></em></a> </span>
										</div>
										<div class="comment-box J_comment_box">
											<div class="tab-box J_site_comment" data-loaded="true">
												<ul id="pageListArray">
													<?php
														$sellerEvaDB=new Model('seller_evaluation');
														$sellerIDCondition['seller_id']=$sellerID;
														$seller_eva_id=$sellerEvaDB->where($sellerIDCondition)->order('datetime desc')->getField('seller_eva_id',true);
														$number=count(seller_eva_id);
													?>
												
													<if condition="$seller_eva_id eq ''">
														<li class="site-item Fix">暂无评价</li>
													</if>
													<volist name="seller_eva_id" id="eva_id" key="i">
														<if condition="$i gt 5">
															<li id="item_{$i}" class="site-item Fix Hide">
														<else/>
															<li id="item_{$i}" class="site-item Fix">
														</if>
															<?php
																$sellerEvaViewDB=new Model('view_seller_eva');
																$EvaIDCondition['seller_eva_id']=$eva_id;
																$user_name=$sellerEvaViewDB->where($EvaIDCondition)->getField('username');
																$score_s=$sellerEvaViewDB->where($EvaIDCondition)->getField('score_service');
																$score_e=$sellerEvaViewDB->where($EvaIDCondition)->getField('score_enviroment');
																$seller=$sellerEvaViewDB->where($EvaIDCondition)->getField('seller_name');
																$content=$sellerEvaViewDB->where($EvaIDCondition)->getField('eva_content');
																$datetime=$sellerEvaViewDB->where($EvaIDCondition)->getField('datetime');
																
															?>
															
															<div class="avatar">																
																<p class="name">{$user_name}</p>
															</div>
															<div class="comment-body J_comment_body">
																<div class="user-info">
																	<div class="comment-rst">
																		<span class="rst">环境:{$score_e}分</span> 
																	</div>
																	<span title="" class="item-rank-rst irr-star{$score_e}0"></span>
																	<div class="comment-rst">
																		<em class="sep">|</em> <span class="rst">服务:{$score_s}分</span> 
																	</div>
																	<span title="" class="item-rank-rst irr-star{$score_s}0"></span>
																	
																	<span class="branch-name"><a href="" >{$seller}</a></span>
																</div>
																<div class="misc-info">
																	<p> {$content}</p>
																</div>
																<div class="misc-info">
																	<span class="time"> {$datetime}</span>																
																</div>
															</div>
														</li>
													</volist>													
												</ul>
												<div class="pages-wrap J_tab2_pagewrap">
													<div class="Pages">
													<?php
														$pageNumber=floor (count($seller_eva_id)/5);
													?>
														<if condition="$pageNumber gt 0">
															<a class="LastPage" title="上一页">上一页</a>
															<span class="pageTagArray" data="1">
															<a id="page_1" class="PageSel pageTag" >1</a> 
															<for start="1" end="($pageNumber+1)">
																<a id="page_{$i+1}" class="PageLink pageTag">{$i+1}</a> 
															 </for>	
															</span>
															<a class="NextPage" title="下一页" data="{$pageNumber+1}">下一页</a>
														</if>													
													</div>
												</div>
											</div>
										</div>
									</div>
									<div class="detail J_tab J_loadTab">
										<div class="comment-tab J_comment_tab">
										</div>
										<div class="comment-box J_comment_box">
											<div class="tab-box Hide J_site_comment imgloading">
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>						
					</div>
				</div>
			</div>
			<!---侧边栏--->
			<include file="./Home/Tpl/Public/sidebar.html"/>
			<!---侧边栏--->
		</div>
	</div>

	<!---footer-->
		<include file="./Home/Tpl/Public/footer.html"/>
	<!---footer-->

</body>
	<script type="text/javascript" src="__PUBLIC__/js/jquery-1.11.1.min.js"></script>
<script type="text/javascript">
	// 百度地图API功能
	var position=$("#position").attr('data');
	var xy= position.split(",");
	var city=$("#city").attr('data');
	
	var map = new BMap.Map("allmap");    // 创建Map实例
	map.centerAndZoom(new BMap.Point(Number(xy[0]),Number(xy[1])), 21);  // 初始化地图,设置中心点坐标和地图级别
	map.setCurrentCity(city);          // 设置地图显示的城市 此项是必须设置的
</script>
	<script type="text/javascript">
		$(".pageTag").click(function(){	
			pageClean();	
			$(this).addClass("PageSel");			
			var data=Number($(this).html());
			change_page(data);	
		});
		
		function pageClean(){
			$(".pageTagArray").children().removeClass("PageSel");
			$(".pageTagArray").children().addClass("PageLink");
			$("#pageListArray").children().addClass("Hide");
		}
		$(".NextPage").click(function(){	
			
			var current=$(".pageTagArray").attr('data');			
			var data=Number(current)+1;
			var max=Number($(".NextPage").attr('data'));
			if(data<=max){
				pageClean();
				change_page(data);	
			}
		
		});
		$(".LastPage").click(function(){	
			
			var current=$(".pageTagArray").attr('data');
			
			var data=Number(current)-1;
			if(data>0){
				pageClean();
				change_page(data);	
			}			
		});
		function change_page(data){
			$("#page_"+data).addClass("PageSel");						
			$(".pageTagArray").attr('data',data);	
			var start=(data-1)*5;
			$("#item_"+(start+1)).removeClass("Hide");
			$("#item_"+(start+2)).removeClass("Hide");
			$("#item_"+(start+3)).removeClass("Hide");
			$("#item_"+(start+4)).removeClass("Hide");
			$("#item_"+(start+5)).removeClass("Hide");
		}
			
	
	</script>
	<script type="text/javascript" src="__PUBLIC__/js/jquery-1.11.1.min.js"></script>
	<script type="text/javascript" src="__PUBLIC__/js/jquery.qrcode.min.js"></script>
	<script type="text/javascript">
		$(function(){
			$('#output').qrcode($('#output').attr('data'));
		});
	</script>
</html>
