<!DOCTYPE html>
<html class="G_N">
<head>
<meta charset="UTF-8"/>
<title>团购网站</title>
<link rel="stylesheet" href="__PUBLIC__/css/cssnew/main/base-old.min.97b2942750e98b1213fe2f167b08db28.css" type="text/css" />
<link rel="stylesheet" href="__PUBLIC__/css/cssnew/group/community-old.1e8d31c8f7429f34295c0c34107785e6.css" type="text/css" />
<link rel="stylesheet" href="__PUBLIC__/css/cssnew/newhome/index.min.05bc1f8116a303ec3ea228348bbf6db5.css" type="text/css" />
<!-- <link rel="stylesheet" href="http://j2.s2.dpfile.com/s/c/app/main/base-old.97b2942750e98b1213fe2f167b08db28.css" type="text/css" />
<link rel="stylesheet" href="http://j3.s2.dpfile.com/s/c/app/group/community-old.1e8d31c8f7429f34295c0c34107785e6.css" type="text/css" />
<link rel="stylesheet" href="http://t3.s2.dpfile.com/t/cssnew/newhome/index.min.f0d842c5a6164286508bc847f37723b1.css" type="text/css" /> -->
<style type="text/css">
body{
	background-color:#fafafa;
}
.page-as .section {
float: right;
width: 900px;
padding-left: 10px;
overflow: hidden;
-webkit-text-size-adjust: none;
}
</style>
<meta charset="UTF-8" />
<meta http-equiv="mobile-agent" content="format=html5; url=http://m.dianping.com/forum/"/>
</head>
<body id="top">
	<!---标题栏---->
		<include file="./Home/Tpl/Public/header.html"/>
	<!---标题栏---->
	
		<div class="head responsive">
		<!---Logo栏---->
			<include file="./Home/Tpl/Public/logobar.html"/>
		<!---Logo栏---->
		
		<div class="nav-bar">
			<div class="cont">
				<!-----主菜单---->
					<include file="./Home/Tpl/Public/menu.html"/>
				<!-----主菜单---->
			</div>
		</div>
	</div>

		<div class="main page-as page-community-home Fix" style="width: 1160px; margin-top: 30px;">
		
			<div class="section">
				<!---<div class="features-wrapper">--->
				<div class="features-wrapper" >
					<!---center--->
					<div class="block b-features" style="width: 680px;">
						<div class="block-title" style="width: 650px;">
							热点推荐
						</div>						
						<!--帖子-->
						<ul class="topic-list">
							<?php
								$communityDB=new Model('community');
								$communityList=$communityDB->order('rand()')->limit(6)->getField('community_id',true);							
							?>	
							<volist name="communityList" id="communityID">
								<?php
									$communityIDCondition['community_id']=$communityID;
									$title=$communityDB->where($communityIDCondition)->getField('title');
									$type=$communityDB->where($communityIDCondition)->getField('community_type');
									$date=$communityDB->where($communityIDCondition)->getField('datetime');
								?>
								<li>
									<a class="term">[{$type}]</a>
									<a title={$title} href="__APP__/Community/cmnty_info?communityID={$communityID}">{$title}</a>
									<span class="i-hot">hot</span>
									<span class="misc">{$date}</span>
								</li>
							</volist>							
						</ul><!--帖子-->
					</div><!---center--->
					
					
					<!---热门--->
					<div class="block b-hotTopics">
						<div class="block-title">
							热门话题
						</div>
						<?php
							$communityDiscussViewDB=new Model('view_community_discuss_sum');
							$communityTopicList=$communityDiscussViewDB->order('discuss_num desc')->limit(6)->getField('community_id',true);							
						?>
						<ul class="title-list num-list">
							<volist name="communityTopicList" id="topicID">
								<?php
									$TopicCondition['community_id']=$topicID;
									$num=$communityDiscussViewDB->where($TopicCondition)->getField('discuss_num');		
									$title=$communityDiscussViewDB->where($TopicCondition)->getField('title');	
									$title=mb_substr($title,0,9,'utf-8')."...";
								?>
								<li><span class="nl-top">{$num}</span>
									<h4><a title="{$title}" href="__APP__/Community/cmnty_info?communityID={$topicID}">{$title}</a></h4>
								</li>
							</volist>	
						</ul>
					</div>	<!---热门--->		
				</div><!---<div class="features-wrapper">--->
			
				<div class="features-wrapper">
					<!---center--->
					<div class="block b-features"  style="width: 680px;">
						<?php
							$communityDB=new Model('community');
							if($typeName ==''){
								$basicTitle="全部发帖";
								$communityList=$communityDB->order('datetime desc')->getField('community_id',true);	
							}else{
								$basicTitle= $typeName."发帖";
								$communityTypeCondition['community_type']=$typeName;
								$communityList=$communityDB->where($communityTypeCondition)->order('datetime desc')->getField('community_id',true);	
							}
							
						?>	
						<div class="block-title" style="width: 650px;">
							{$basicTitle}
						</div>						
						<!--帖子-->
						<ul class="topic-list" id="pageListArray">

							<volist name="communityList" id="communityID" key="i">
								<?php
									$communityIDCondition['community_id']=$communityID;
									$title=$communityDB->where($communityIDCondition)->getField('title');
									$type=$communityDB->where($communityIDCondition)->getField('community_type');
									$date=$communityDB->where($communityIDCondition)->getField('datetime');
								?>
								<if condition="$i gt 15">
									<li id="item_{$i}" class="Hide">			
								<else/>
									<li id="item_{$i}">
								</if>							
								
									<a class="term">[{$type}]</a>
									<a title={$title} href="__APP__/Community/cmnty_info?communityID={$communityID}">{$title}</a>
									<span class="i-hot">hot</span>
									<span class="misc">{$date}</span>
								</li>
							</volist>							
						</ul><!--帖子-->
						<div class="pages-wrap J_tab2_pagewrap">
							<div class="Pages">
							<?php
								$pageNumber=floor (count($communityList)/15);
							?>
								<if condition="$pageNumber gt 0">
									<a class="LastPage" title="上一页">上一页</a>
									<span class="pageTagArray" data="1">
									<a id="page_1" class="PageSel pageTag" >1</a> 
									<for start="1" end="($pageNumber+1)">
										<a id="page_{$i+1}" class="PageLink pageTag">{$i+1}</a> 
									 </for>	
									</span>
									<a id="NextPage" title="下一页" data="{$pageNumber+1}">下一页</a>
								</if>													
							</div>
						</div>
					</div><!---center--->
					
					
					<!--/会员热榜-->
					<div class="block-sub block-memberList" style="margin-left: 27px;">
						<div class="block-title">
							会员热榜
						</div>
						<div class="block-inner">
							<ul class="figure-list">
								<?php
									$communityUserDB=new Model('view_community_customer');
									$UserIDList=$communityUserDB->order('customer_number desc')->limit(10)->getField('customer_id',true);						
								?>
								<volist name="UserIDList" id="userID">
									<li>
										<?php
											$communityViewIDCondition['customer_id']=$userID;
											$customer_number=$communityUserDB->where($communityViewIDCondition)->getField('customer_number');
											$username=$communityUserDB->where($communityViewIDCondition)->getField('username');									
										?>									
										<a class="J_card">
											{$username}
										</a> 
										<em class="membercount"><span class="misc">{$customer_number}</span>帖子</em>
									</li>
								</volist>	
										
							</ul>
						</div>
					</div><!--/会员热榜-->
				</div><!---<div class="features-wrapper">--->	
			</div>
			<!-----分类目录---->
			<div class="aside">
				<div class="aside-left">
					<div class="block b-nav">
						<div class="block-title tabbed-title">
							<ul class="tab-list">
								<li class="tab active"><a id="discuss" href="#">社区中心</a></li>	
							</ul>
						</div>
						<div hand-mark="discuss">
							<ul class="bullet-list">	
								<li class="root-item"> <strong class="root-name"><a href="__APP__/Community/community">全部分类</a></strong>
									<ul class="sub-nav">
										<?php
											$communityDB=new Model('community');
											$communityTypeList=$communityDB->distinct(true)->getField('community_type',true);
											$listNum = count($communityTypeList);
										?>
										<volist name="communityTypeList" id="type">
											<li>
												<a href="__APP__/Community/selectType?typeName={$type}">
													{$type}
												</a>
											</li>														
										</volist>				
									</ul>
								</li>									
							</ul>
						</div>	
						<div class="block-title tabbed-title">

							<strong class="btn-type-a btn-fn-a">
								<a href ="__URL__/newTopic" class="form-btn">
									<span style="font-size:14px" >
										发表新帖
									</span>
								</a>
							</strong>
							
						</div>
					</div>
				</div>
			</div><!-----分类目录---->
			
		</div>
	<!---footer-->
	<include file="./Home/Tpl/Public/footer.html"/>
	
	<!---footer-->
</body>
<script type="text/javascript" src="__PUBLIC__/js/jquery-1.11.1.min.js"></script>
	<script type="text/javascript">
		$(".pageTag").click(function(){	
			pageClean();	
			$(this).addClass("PageSel");			
			var data=Number($(this).html());
			change_page(data);	
		});
		
		function pageClean(){
			$(".pageTagArray").children().removeClass("PageSel");
			$(".pageTagArray").children().addClass("PageLink");
			$("#pageListArray").children().addClass("Hide");
		}
		
		$("#NextPage").click(function(){				
			var current=$(".pageTagArray").attr('data');			
			var data=Number(current)+1;
			var max=Number($("#NextPage").attr('data'));
			if(data<=max){
				pageClean();
				change_page(data);	
			}	
		});
		
		$(".LastPage").click(function(){	
			
			var current=$(".pageTagArray").attr('data');
			
			var data=Number(current)-1;
			if(data>0){
				pageClean();
				change_page(data);	
			}			
		});
		function change_page(data){
			$("#page_"+data).addClass("PageSel");						
			$(".pageTagArray").attr('data',data);	
			var start=(data-1)*15;
			for(var i=0;i<15;i++){
				$("#item_"+(start+i+1)).removeClass("Hide");	
			}
		}
	</script>
</html>
