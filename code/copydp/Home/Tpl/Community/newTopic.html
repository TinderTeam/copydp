<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8"/>

<title>笑谣林</title>
<link rel="stylesheet" href="__PUBLIC__/css/cssnew/newhome/index.min.05bc1f8116a303ec3ea228348bbf6db5.css" type="text/css" />
<link rel="stylesheet" href="__PUBLIC__/css/cssnew/newhome/rate-pop.min.5ec84ae0b63499fec0e87d82923458a0.css" type="text/css" />
<link rel="stylesheet" href="__PUBLIC__/css/cssnew/newhome/order.min.5a7226cd2f3426def2f1ad35c9e6efa2.css" type="text/css" />
<link rel="stylesheet" href="__PUBLIC__/css/cssnew/newhome/c.process.min.92c908b76c13b72d9517a6cd433cc597.css" type="text/css" />
<link rel="stylesheet" href="__PUBLIC__/css/cssnew/main/base-old.min.97b2942750e98b1213fe2f167b08db28.css" type="text/css" />
<link rel="stylesheet" href="__PUBLIC__/css/cssnew/shop/add.min.0fe62b4e4cc3553c338ed7e73a89c1e4.css" type="text/css" />

<!-- <link type="text/css" href="http://t3.s2.dpfile.com/t/cssnew/my/index.min.81e8e568c7d3705cb3d1ecc2cf472b7d.css" rel="stylesheet"/>
<link rel="stylesheet" href="http://t2.s2.dpfile.com/t/cssnew/my/rate-pop.min.5ec84ae0b63499fec0e87d82923458a0.css" type="text/css" />
<link type="text/css" href="http://t1.s2.dpfile.com/t/cssnew/my/order.min.5a7226cd2f3426def2f1ad35c9e6efa2.css" rel="stylesheet"/>
<link rel="stylesheet" href="http://t3.s2.dpfile.com/t/cssnew/neworder/page/c.process.min.92c908b76c13b72d9517a6cd433cc597.css" type="text/css" />
<link rel="stylesheet" href="http://j1.s2.dpfile.com/s/c/app/main/base-old.min.97b2942750e98b1213fe2f167b08db28.css" type="text/css" />
<link rel="stylesheet" href="http://j2.s2.dpfile.com/s/c/app/shop/add.min.0fe62b4e4cc3553c338ed7e73a89c1e4.css" type="text/css" /> -->
  <script type="text/javascript">
	window.UEDITOR_HOME_URL = "__ROOT__/Public/ueditor/";
  </script>
	<!---footer-->
	
	<link href="__PUBLIC__/ueditor/themes/default/css/umeditor.css" type="text/css" rel="stylesheet">	
</head>

<body id="body" data-type="">
	<!---标题栏---->
		<include file="./Home/Tpl/Public/header.html"/>
	<!---标题栏---->
	
	<div class="head responsive">
		<!---Logo栏---->
			<include file="./Home/Tpl/Public/logobar.html"/>
		<!---Logo栏---->
		
		<div class="nav-bar">
			<div class="cont">

				<!-----主菜单---->
					<include file="./Home/Tpl/Public/menu.html"/>
				<!-----主菜单---->
			</div>
		</div>
	</div>
	
	<!---主页面---->
	<div class="wrap">
		<!---左侧导航栏--->
		<div class="user-nav J_user_nav">
			<!-----管理菜单---->
			<ul>
				<li class="cur"><a href="#">发表话题</a><i class="n-arr"></i></li>
			</ul>
			<!-----管理菜单---->
		</div><!---左侧导航栏--->
		<!---中间主要内容--->
		<div class="main_w Tabs-page user-main  page-account">	
			<div class="user-main">
				<!---产品信息编辑--->
				<div class="um-con">
					<!--标题-->
					<div class="modebox my-booking J_my_booking">
						<div class="hd">
							<h4>
							<?php
								if($communityID==0){
									$type = 'create';
								}else{
									$type='edit';
								}
								$communityDB = M('community');
								$condition['community_id']=$communityID;
								$community = $communityDB->where($condition)->find();
			
							?>
								发表新话题
							</h4>	
						</div> 	
					</div> 	<!--标题--> 
					<!--表单-->
					<form id="form" name="form" action="__URL__/saveTopic" method="post" enctype="multipart/form-data">
						<div class="con">
							<div class="main page-sa page-sa-col Fix">
								<div class="block shop-add-form">
									<!--表单内容-->									
										<div class="form-inner">
										
											<div class="form-block">
												<label class="label label_required" >标题：<em>*</em></label>
												<input type="text" maxlength="50" class="form-txt form-txt-l" 
												autocomplete="off" size="60" value="{$community.title}"   name="title">
												
											</div>
											<if condition=" $type eq 'edit'">
											
											<else/>
												<div id="trPriceInfo"  class="form-block">
													<span class="label label_required">话题类型<em>*</em></span>
										
													<select class="form-select-sim selectTarget" name="community_type">
														<option  value="">请选择分类</option>													
														<option  value="房介信息">房介信息</option>	
														<option  value="应聘信息">应聘信息</option>	
														<option  value="招聘信息">招聘信息</option>	
													</select>																			
												</div>
											</if>
											
											
											<div class="form-block">
												<span class="label">话题内容</span>									
											</div>  
											<div class="form-block" style="margin-left: 85px;">				
												<div class="Hide typehide" data="{$type}">{$community.context}</div>
												<input class="Hide" value="edit" name="type">
												<input class="Hide" value="{$community.community_id}" name="communityID">
												<textarea id="info-text" ip="__PUBLIC__/" name="info" class="Hide" value="{$community.context}"></textarea>
												<script id="editor" type="text/plain" class="form-default" style="width:500px;">
												</script>									
											</div>  	
									 </div><!--表单内容-->
								 <!--提交区域-->
									<div class="block form-btn-block form-block form-content-block">
										<div class="btn-type-b btn-fn-c">										
											<input type="button" value="提交" class="form-btn submit-btn"/>
										</div> 
									</div><!--提交区域-->
								</div>
							</div>		
						</div><!--表单-->
					</form>				
            </div><!---产品信息编辑--->
		</div>
	</div><!---中间主要内容--->
</div><!---主页面---->

	<!---footer-->
		<include file="./Home/Tpl/Public/footer.html"/>
	<!---footer-->
	<script type="text/javascript" src="__PUBLIC__/js/jquery-1.11.1.min.js"></script>	
	<script type="text/javascript" charset="utf-8" src="__PUBLIC__/ueditor/umeditor.min.js"> </script>
    <script type="text/javascript" charset="utf-8" src="__PUBLIC__/ueditor/umeditor.config.js"></script>
    <!--建议手动加在语言，避免在ie下有时因为加载语言失败导致编辑器加载失败-->
	<!--这里加载的语言文件会覆盖你在配置项目里添加的语言类型，比如你在配置项目里配置的是英文，这里加载的中文，那最后就是中文-->
    <script type="text/javascript" charset="utf-8" src="__PUBLIC__/ueditor/lang/zh-cn/zh-cn.js"></script>
	<script type="text/javascript">	
	   //实例化编辑器		//建议使用工厂方法getEditor创建和引用编辑器实例，如果在某个闭包下引用该编辑器，直接调用UE.getEditor('editor')就能拿到相关的实例
		var um = UM.getEditor('editor');
		
		var type = $('.typehide').attr('data');
		if(type == 'edit' ){
			um.setContent($('.typehide').html());
		}
		
		$(".submit-btn").click(function(){
			var txt=UM.getEditor('editor').getContent();//获得描述内容
			//测试描述内容
			//var txt = '<p><img src=\"http://127.0.0.1:89/DIYBuy/app/Public/ueditor/php/upload/20141008/14127569472248.jpg\" _src=\"http://127.0.0.1:89/DIYBuy/app/Public/ueditor/php/upload/20141008/14127569472248.jpg\"/></p><p><img src=\"http://127.0.0.1:89/DIYBuy/app/Public/ueditor/php/upload/20141008/14127569585354.jpg\" _src=\"http://127.0.0.1:89/DIYBu"';   
			//var restr = /src\s*=\Shttp:\S{2,2}[\d]{1,3}.[\d]{1,3}.[\d]{1,3}.[\d]{1,3}:[\d]{0,4}\SDIYBuy\Sapp\SPublic\Sueditor\Sphp\Supload\S\w{0,}\S\w{0,}.jpg\"/g;    
			//匹配正则表达式
			//var ipStr = /<img src\s*=\Shttp:\S{2,2}[\d]{1,3}.[\d]{1,3}.[\d]{1,3}.[\d]{1,3}:[\d]{0,4}\SDIYBuy\Sapp\SPublic\S/g; 
			
			var ipStr = /<img src\s*=\S{1,}(http|https):\S{2,2}\S{1,}\SDIYBuy\Sapp\SPublic\S/g;
			//获取上传的路径		
			var array=txt.match(ipStr);
			//alert(array);
			if(array!=null){
				
				//获取系统路径
				var path=$("#info-text").attr('ip');				
				for(var i = 0 ;i<array.length;i++ ){
					//全文替换
					txt = txt.replace(array[i],"<img src="+'"'+path);
				}
				
			}
			txt=txt.replace(/\"/g,"");			
			$("#info-text").val(txt);
			//alert("最终结果："+$("#info-text").val());
			$("#form").submit();
		});
	</script>

</body>
</html>
