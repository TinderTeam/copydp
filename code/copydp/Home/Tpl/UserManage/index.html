<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8"/>

<title>笑谣林</title>
<link href="__PUBLIC__/css/fuego.management.css" type="text/css">
<link rel="stylesheet" href="__PUBLIC__/css/cssnew/newhome/rate-pop.min.5ec84ae0b63499fec0e87d82923458a0.css" type="text/css" />
<link rel="stylesheet" href="__PUBLIC__/css/cssnew/newhome/order.min.5a7226cd2f3426def2f1ad35c9e6efa2.css" type="text/css" />
<link rel="stylesheet" href="__PUBLIC__/css/cssnew/newhome/c.process.min.92c908b76c13b72d9517a6cd433cc597.css" type="text/css" />
<link rel="stylesheet" href="__PUBLIC__/css/cssnew/main/base-old.min.97b2942750e98b1213fe2f167b08db28.css" type="text/css" />
<link rel="stylesheet" href="__PUBLIC__/css/cssnew/shop/add.min.0fe62b4e4cc3553c338ed7e73a89c1e4.css" type="text/css" />
<!-- <link rel="stylesheet" href="http://t2.s2.dpfile.com/t/cssnew/my/rate-pop.min.5ec84ae0b63499fec0e87d82923458a0.css" type="text/css" />
<link type="text/css" href="http://t1.s2.dpfile.com/t/cssnew/my/order.min.5a7226cd2f3426def2f1ad35c9e6efa2.css" rel="stylesheet"/>
<link rel="stylesheet" href="http://t3.s2.dpfile.com/t/cssnew/neworder/page/c.process.min.92c908b76c13b72d9517a6cd433cc597.css" type="text/css" />
<link rel="stylesheet" href="http://j1.s2.dpfile.com/s/c/app/main/base-old.min.97b2942750e98b1213fe2f167b08db28.css" type="text/css" />
<link rel="stylesheet" href="http://j2.s2.dpfile.com/s/c/app/shop/add.min.0fe62b4e4cc3553c338ed7e73a89c1e4.css" type="text/css" /> -->
<style>
body {
	background-color: #f2f2f2;
}
.wrap{
width: 1190px;
margin: 15px auto;
}
.wrap .user-main {
float: right;
width: 1000px;
}

.user-main .um-con .modebox li {
float: left;
height: 39px;
width: 190px;
margin-right: 10px;
}
.span-input{
	margin-top: 5px;
}

.btnbar{
    margin-left: 5px;
    margin-right: 5px;

}
</style>
</head>
<body id="body" data-type="">
	<!---标题栏---->
		<include file="./Home/Tpl/Public/header.html"/>
	<!---标题栏---->
	
	<div class="head responsive">
		<!---Logo栏---->
			<include file="./Home/Tpl/Public/logobar.html"/>
		<!---Logo栏---->		
		<div class="nav-bar">
			<div class="cont">	
				<!-----主菜单---->
					<include file="./Home/Tpl/Public/menu.html"/>
				<!-----主菜单---->
			</div>
		</div>
	</div>
	<div class="wrap">
		<div class="user-nav J_user_nav">
			<!-----管理菜单---->
				<include file="./Home/Tpl/Public/managemenu.html"/>
			<!-----管理菜单---->
		</div>
		<div class="user-main">
			<div class="um-con">
				<div class="modebox my-comm J_my_comm" >
				<input id="nav" value="{$nav}" style="display:none;"/>
				<form  name="forml" action="__URL__/search" method="post">
					<div class="hd">
						<h4>会员管理</h4>
						<span>管理系统用户</span>	
					</div>								
					<ul class="tab-filter">
						<li>
							<div class="span-input">
								<span >会员编号</span><input type="text" name="userID"/>
							</div>
						</li>
						<li>
							<div class="span-input">
								<span >会员名称</span><input type="text" name="userName"/>
							</div>
						</li>
						<li>
							<div class="span-input">
								<span >手机</span><input type="text" name="phoneNum"/>
							</div>							
						</li>
						
						<li>
							<div class="span-input">
								<span >用户级别</span>
								<select name="grade" class="span-select">
									<option value=""/>全部
									<option value="SVIP"/>SVIP
									<option value="VIP"/>VIP
								</select>
							</div>							
						</li>
						<li>
							<strong class="btn-type-b btn-fn-c btnbar">
								<input id="btnAdd" type="submit" value="查询" class="form-btn">
							</strong> 
							<strong class="btn-type-b btn-fn-c btnbar">			
								<input type="button" value="新增" class="form-btn" onclick="location.href='__APP__/UserManage/userAdd'" />
							</strong> 
						</li>
					</ul>
				</form>	
				
					<div class="pay-confirm">
						<form id="freezeControl" action="__URL__/freezeControl?type=" method="post">
						<table width="100%" class="confirm-order-tab" cellpadding="0" cellspacing="0">
							<tbody>
								<tr>
									<th width="5%">
										<input type="checkbox" name="chkAll" id="chkAll" onclick="selectAll('chkID_[]','chkAll')">
									</th>
									<th width="10%">会员编号</th>
									<th width="10%">会员名称</th>
									<th width="10%">会员级别</th>	
									<th width="10%">注册时间</th>
									<th width="10%">积分</th>
									<th width="15%">手机</th>	
									<th width="15%">SVIP到期时间</th>	
									<th width="15%">用户状态</th>							
									<th width="30%">操作</th>
								</tr>
						<foreach name='userInfo' item='v1'>						
								<tr>
									<td class="t-check">
										<input type="checkbox" name="chkID_[]" id="chkID_[{$key+1}]" value="{$v1.user_id}"/>
									</td>
									<td align="center" class="deal">{$v1.user_id}</td>
									<td align="center" class="deal">{$v1.username}</td>
									<td align="center" >{$v1.grade}</td>
									<td align="center" >{$v1.create_date}</td>
									<td align="center"> {$v1.score}</td>
									<td align="center" >{$v1.cellphone}</td>
									<td align="center" >{$v1.vip_limit_date}</td>
									<td align="center">{$v1.status}</td >		
									<td valign="middle">
										<if condition="$v1.status eq '冻结' ">
											<input type="submit" value="解冻"  onclick="javascript:this.form.action='__URL__/unfreeze?id={$v1.user_id}';"/>
										<else/>
											<input type="button" value="冻结" class="form-btn"  onclick="show_freeze_confirm('{$v1.user_id}')"/>
											<!--<input type="submit" value="冻结"  onclick="javascript:this.form.action='__URL__/freeze?id={$v1.user_id}';"/>-->
										</if>
										<if condition="$v1.grade eq 'SVIP' ">
											<input type="submit" value="降级"  onclick="javascript:this.form.action='__URL__/downgrade?id={$v1.user_id}';"/>
										<else/>
											<input type="submit" value="升级"  onclick="javascript:this.form.action='__URL__/upgrade?id={$v1.user_id}';"/>
										</if>										
									</td>
								</tr>
						</foreach>
						
						  <tr >
						  
                            <td colspan="8" style=" text-align: center;" ><span>{$page}</span></td>
                          </tr>

							</tbody>
						</table>
						
						<strong class="btn-type-b btn-fn-c btnbar">
							 <input type="button" value="批量冻结" name="subSure" class=" form-btn" onclick="freezesbmt()" /> 
						</strong>
						<strong class="btn-type-b btn-fn-c btnbar">
							 <input type="button" value="批量解冻" name="subSure" class=" form-btn" onclick="unfreezesbmt()" />
						</strong>
						</form>
					</div>
				</div>
			</div>
			
			
			<div class="um-con">
				<div class="modebox my-comm J_my_comm" >
					<div class="hd">
						<h4 id="UserRequest">用户请求处理</h4>
						<span>处理用户的升级、审核请求</span>
					</div>
					<div class="pay-confirm">
						<table width="100%" class="confirm-order-tab" cellpadding="0" cellspacing="0">
							<tbody>
								<tr>
									<th width="20%">会员编号</th>
									<th width="15%">会员名称</th>
									<th width="10%">会员级别</th>	
									<th width="15%">会员状态</th>
									<th width="20%">手机号码</th>							
									<th width="20%">操作</th>
								</tr>
								<?php //用户数据读取区域
								
									$customer=new Model('view_customer');
									import("ORG.Util.Page"); 
									
									//$userOperate=$customer->where('user_id=3')->select();	
									//$condition['request'] != 'null';
									$map['request']  = array('neq','null');
									$count = $customer->where($map)->count(); 
									$Page = new Page($count,5); 
									$page2 = $Page->show();
									$userOperate=$customer->where($map)->order('user_id')->limit($Page->firstRow.','.$Page->listRows)->select();
																
								
								?>
								<form name="form3" action="__URL__/search" method="post">
								<foreach name='userOperate' item='v2'>
								
								<tr>
									<td valign="middle" align="center" class="deal" name="userID">{$v2.user_id}</td>
									<td valign="middle" align="center" class="deal">{$v2.username}</td>
									<td align="center" >{$v2.grade}</td>
									<td align="center" >{$v2.status}</td>
									<td align="center" >{$v2.cellphone}</td>
									<td align="center" >
										<input type="submit" value="{$v2.request}"  onclick="javascript:this.form.action='__URL__/requestDeal?id={$v2.user_id}';"/>
										<input type="submit" value="拒绝" onclick="javascript:this.form.action='__URL__/requestDelete?id={$v2.user_id}';"/>
									</td>
								</tr>
								
								</foreach>
								</form>
								<tr>
									<td colspan="6" style=" text-align: center;" ><span>{$page2}</span></td>
								</tr>
							</tbody>
						</table>
					</div>
				</div>
			</div>
			<div class="um-con">
				<div class="modebox my-comm J_my_comm" >
					<div class="hd">
						<h4 id="ScoreManage">积分管理</h4>
						<span>管理员对积分进行管理</span>
					</div>
				<form name="form4" action="__URL__/searchScore" method="post">
					<ul class="tab-filter">
						<li>
							<div class="span-input">
								<span>用户编号</span><input type="text" name="userID"/>
							</div>								
						</li>
						<li>
							<strong class="btn-type-b btn-fn-c">
								<input  type="submit" value="查询" class="form-btn">
							</strong> 			
						</li>
					</ul>
				</form>
					<div class="pay-confirm">
						<table width="100%" class="confirm-order-tab" cellpadding="0" cellspacing="0">
							<tbody>
								<tr>
									<th width="20%">会员编号</th>
									<th width="20%">会员名称</th>
									<th width="15%">积分</th>
									<th width="10%">变更后积分值</th>					
									<th width="5%">操作</th>
								</tr>
						
						<foreach name='scoreInfo' item='v3'>
						<form name="form5" action="__APP__/modifyScore" method="post">
								<tr>
									<td align="center" name="scoreID">{$v3.user_id}</td>
									<td align="center" >{$v3.username}</td>
									<td align="center" >{$v3.score}</td>
									<td align="center" ><input type="num" name="newScore"></td>
									<td align="center" >
									<input type="submit" value="确认" onclick="javascript:this.form.action='__URL__/modifyScore?id={$v3.user_id}';"/>
									</td>
								</tr>
						</form >
						</foreach>
							
							</tbody>
						</table>
					</div>
				</div>
			</div>
			
			<div class="um-con">
				<div class="modebox my-comm J_my_comm" >
					<div class="hd">
						<h4 id="CodeManage">激活码管理</h4>
						<span>管理激活码发放</span>
					</div>
					<form name="form4" action="__URL__/SearchCode" method="post">
						<ul class="tab-filter">
							<li>
								<div class="span-input">
									<span>激活码查询</span>
									<select name= "codeStatus">
										<option value="全部">全部</option>
										<option value="已使用">已使用</option>
										<option value="未使用">未使用</option>
									</select>					
								</div>								
							</li>
							<li>
								<strong class="btn-type-b btn-fn-c">
									<input  type="submit" value="查询" class="form-btn">									
								</strong> 			
							</li>
						</ul>
						<ul class="tab-filter">
							<li>
								<div class="span-input">
									<span>下发激活码</span>
									<span><input id ="codeid" type="number" value="10" style="width:30px"/>个</span>								
								</div>								
							</li>
							<li>
								<strong class="btn-type-b btn-fn-c">
									<input type="button" value="下发" class="form-btn" onclick="createCode()">									
								</strong> 			
							</li>
						</ul>
					</form>
					<div class="pay-confirm">
						<table width="100%" class="confirm-order-tab" cellpadding="0" cellspacing="0">
							<tbody>
								<tr>
									<th width="20%">激活码</th>
									<th width="20%">状态</th>
									<th width="20%">操作</th>
								</tr>
						
							<foreach name='codeList' item='codeItem'>
								<tr>
									<td align="center" name="scoreID">{$codeItem.code}</td>
									<td align="center" >{$codeItem.status}</td>								
									<td align="center" >
						 			<input type="button" value="删除" class="form-btn"  onclick="show_delete_confirm('{$codeItem.code}')"/>
									</td>
								</tr>
							</foreach>
								
							</tbody>
						</table>
					</div>
				</div>
			</div>
		</div>
	</div>
	
	<!---footer-->
		<include file="./Home/Tpl/Public/footer.html"/>
	<!---footer-->
		
	<script type="text/javascript" src="__PUBLIC__/js/jquery-1.11.1.min.js"></script>
	<script>
		function createCode()
		{
			alert('激活码已生成');
			var num=$("#codeid").val();
			window.location.href='__URL__/createCode?num='+num;
		}
		
		//实现页面内导航跳转
		if("" !=$("#nav").val())
		{
			location.hash=$("#nav").val();
		}
		
		//冻结用户确认
		function show_freeze_confirm(userID)
		{
			var r=confirm("确定要冻结该用户？");
			if(r==true)
			{
				top.location="__APP__/UserManage/freeze?id="+userID;
			}
			else
			{
			}
		}
		
		//删除激活码确认
		function show_delete_confirm(code)
		{
			var r=confirm("确定要删除该激活码？");
			if(r==true)
			{
				top.location="__APP__/UserManage/CodeDelete?code="+code;
			}
			else
			{
			}
		}
		
		//解冻
		function unfreezesbmt()
		{
			var r=confirm("确定要进行批量解冻操作？");
			if(r==true)
			{	
				$("#freezeControl").attr("action",$("#freezeControl").attr("action")+'unfreeze');
				$("#freezeControl").submit();				
			}
			else
			{	
			}
		}
		
		//冻结
		function freezesbmt()
		{
			var r=confirm("确定要进行批量冻结操作？");
			if(r==true)
			{
				$("#freezeControl").attr("action",$("#freezeControl").attr("action")+'freeze');
				$("#freezeControl").submit();
			}
			else
			{
				
			}
		}
		
	</script>
	
	<script type="text/javascript">
		function selectAll(sonName, cbAllId){
			var arrSon = document.getElementsByName(sonName);
			var cbAll = document.getElementById(cbAllId);
			var tempState=cbAll.checked;
			for(i=0;i<arrSon.length;i++) {
				if(arrSon[i].checked!=tempState)
				arrSon[i].click();
				}
			}
	</script>
</body>
</html>
