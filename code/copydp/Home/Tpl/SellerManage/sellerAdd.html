<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8"/>

<title>团购网站</title>
<link rel="stylesheet" href="__PUBLIC__/css/cssnew/newhome/index.min.05bc1f8116a303ec3ea228348bbf6db5.css" type="text/css" />
<link rel="stylesheet" href="__PUBLIC__/css/cssnew/newhome/rate-pop.min.5ec84ae0b63499fec0e87d82923458a0.css" type="text/css" />
<link rel="stylesheet" href="__PUBLIC__/css/cssnew/newhome/order.min.5a7226cd2f3426def2f1ad35c9e6efa2.css" type="text/css" />
<link rel="stylesheet" href="__PUBLIC__/css/cssnew/newhome/c.process.min.92c908b76c13b72d9517a6cd433cc597.css" type="text/css" />
<link rel="stylesheet" href="__PUBLIC__/css/cssnew/main/base-old.min.97b2942750e98b1213fe2f167b08db28.css" type="text/css" />
<link rel="stylesheet" href="__PUBLIC__/css/cssnew/shop/add.min.0fe62b4e4cc3553c338ed7e73a89c1e4.css" type="text/css" />
<!-- <link type="text/css" href="http://t3.s2.dpfile.com/t/cssnew/my/index.min.81e8e568c7d3705cb3d1ecc2cf472b7d.css" rel="stylesheet"/>
<link rel="stylesheet" href="http://t2.s2.dpfile.com/t/cssnew/my/rate-pop.min.5ec84ae0b63499fec0e87d82923458a0.css" type="text/css" />
<link type="text/css" href="http://t1.s2.dpfile.com/t/cssnew/my/order.min.5a7226cd2f3426def2f1ad35c9e6efa2.css" rel="stylesheet"/>
<link rel="stylesheet" href="http://t3.s2.dpfile.com/t/cssnew/neworder/page/c.process.min.92c908b76c13b72d9517a6cd433cc597.css" type="text/css" />
<link rel="stylesheet" href="http://j1.s2.dpfile.com/s/c/app/main/base-old.min.97b2942750e98b1213fe2f167b08db28.css" type="text/css" />
<link rel="stylesheet" href="http://j2.s2.dpfile.com/s/c/app/shop/add.min.0fe62b4e4cc3553c338ed7e73a89c1e4.css" type="text/css" /> -->
  <script type="text/javascript">
	window.UEDITOR_HOME_URL = "__ROOT__/Public/ueditor/";
  </script>
	<!---footer-->
	<link href="__PUBLIC__/ueditor/themes/default/css/umeditor.css" type="text/css" rel="stylesheet">
	<script type="text/javascript" src="__PUBLIC__/js/jquery-1.11.1.min.js"></script>
	<script type="text/javascript" src="__PUBLIC__/js/uploadPreview.min.js"></script>
    <script type="text/javascript" charset="utf-8" src="__PUBLIC__/ueditor/umeditor.config.js"></script>
    <script type="text/javascript" charset="utf-8" src="__PUBLIC__/ueditor/umeditor.min.js"> </script>
    <!--建议手动加在语言，避免在ie下有时因为加载语言失败导致编辑器加载失败-->
    <script type="text/javascript" charset="utf-8" src="__PUBLIC__/ueditor/lang/zh-cn/zh-cn.js"></script>
	<style>
		body {
			background-color: #f2f2f2;
		}
		.wrap{
		width: 1190px;
		margin: 15px auto;
		}
		.wrap .user-main {
		float: right;
		width: 1000px;
		}

		.user-main .um-con .modebox li {
		float: left;
		height: 39px;
		width: 190px;
		margin-right: 10px;
		}
		.span-input{
			margin-top: 5px;
		}

		.span-select{
			width: 129px;
			height: 20px;
		}
		</style>
	<style type="text/css">
		#allmap{
			margin-left: 89px;width: 500px;height: 400px;"
				}
	</style>
	
	<script type="text/javascript" src="http://api.map.baidu.com/api?v=2.0&ak=DNGm7Kq87zslzLLkll9epKQY"></script>
</head>

<body id="body" data-type="">
	<!---标题栏---->
		<include file="./Home/Tpl/Public/header.html"/>
	<!---标题栏---->
	
	<div class="head responsive">
		<!---Logo栏---->
			<include file="./Home/Tpl/Public/logobar.html"/>
		<!---Logo栏---->
		
		<div class="nav-bar">
			<div class="cont">

				<!-----主菜单---->
					<include file="./Home/Tpl/Public/menu.html"/>
				<!-----主菜单---->
			</div>
		</div>
	</div>
	
	<!---主页面---->
	<div class="wrap">
		<!---左侧导航栏--->
		<div class="user-nav J_user_nav">
		
			<?php
				$currentPage='seller';
			?>
			<!-----管理菜单---->
			<include file="./Home/Tpl/Public/managemenu.html"/>
			<!-----管理菜单---->
		</div>
		<!---中间主要内容--->
		<div class="main_w Tabs-page user-main  page-account">	
			<div class="user-main">
				<!---产品信息编辑--->
				<div class="um-con">
					<!--标题-->
					<div class="modebox my-booking J_my_booking">
						<div class="hd">
							<if condition="$pageType eq 'edit'">
								<h4>商家修改</h4>
							<else/>
								<h4>商家新增</h4>
							</if>
								
						</div> 	
					</div> 	<!--标题--> 
					<!--表单-->
				<form id="addForm" name="form" action="__URL__/add" method="post" enctype="multipart/form-data">
				
						<div class="con">
							<div class="main page-sa page-sa-col Fix">
								<div class="block shop-add-form">
									<!--表单内容-->									
										<div class="form-inner">
											<div class="form-block">
												<label class="label label_required" >商户名：<em>*</em></label>
												<if condition="$pageType eq 'edit'">
													<input type="text" maxlength="50"  class="form-txt form-txt-l" autocomplete="off" size="60" value="{$seller.username}" readonly="readonly" name="seller_name">
												<else/>
													<input type="text" maxlength="50"  class="form-txt form-txt-l" autocomplete="off" size="60" value="{$seller.username}" name="seller_name">
												</if>
												
												<span id="fv_shopname" style="visibility: hidden; " class="fv-def"></span>
											</div>    
														
											<div class="form-block">
												<span class="label label_required">类型：<em>*</em></span>
												<?php
														$productType=M('product_type');
														$condition['father_id'] = 0;
														$type=$productType->where($condition)->select();
														
												?>
												<select  onchange="typeSelectChange()" class="form-select-sim selectTarget" >
													<option selected="selected" value="">请选择主类型</option>
													<foreach name='type' item='vt'>
														<option value="{$vt.type_id}" class="fathertype{$vt.type_id}" >{$vt.type_name}</option>	
													</foreach>											
												</select>
												<?php
														$productTypeDB=M('product_type');
														$allType=$productTypeDB->select();
														
												?>
												<select id="typeSelect" name="type_id" class="form-select-sim">
													<option selected="selected" value="">请选择子类型</option>
																							
												</select>
												
												<select id="typeCopy" name="null" class="form-select-sim Hide">
													<option selected="selected" value="">请选择子类型</option>
													<foreach name='allType' item='allvt'>
														<if condition="$allvt.father_id eq '0'">
															<option type_ID="{$allvt.type_id}" father_id="{$allvt.father_id}"  class="typeCopy" value="{$allvt.type_id}">{$allvt.type_name}</option>	
														<else/>
															<option type_ID="{$allvt.type_id}" father_id="{$allvt.father_id}"   class="typeCopy" value="{$allvt.type_id}">{$allvt.type_name}</option>	
														</if>
														
													</foreach>											
												</select>

											</div>
											<div class="form-block">
												<span class="label">概述：</span>
												<textarea name="description" rows="7" cols="50"  class="form-textarea form-default" value="" >{$seller.description}</textarea>
												<span id="fv_TrafficInfo"  class="fv-def"></span>
											</div> 
											<div id="trPriceInfo"  class="form-block">
												<span class="label label_required">地区：<em>*</em></span>
												<?php
												  $citydb= M('city');
												  $city=$citydb->select();
												?>
												<select id="citySelect"  class="form-select-sim" name="city_id" onchange="citySelectChange()">
													<option  value="">请选择城市</option>	
												<foreach name='city' item='vc'>
													<option class="cityid{$vc.city_id}" value="{$vc.city_id}">{$vc.city}</option>	
												</foreach>											
												</select>
											<div id="result"></div>
											<div id="list"></div>
												<?php
													$cityZonedb= M('city_zone');												
													$Zone=$cityZonedb->select();
												?>											
												<select id="zoneSelect" name="zone_id" class="form-select-sim form-select-sim-m zone-select">
													
													<option value="">请选择区域</option>									
													<foreach name='Zone' item='vz'>
														<option class="cityshowOption"  value="{$vz.zone_id}" > {$vz.zone_name}</option>
													</foreach>									
												</select>
												
												<select id="zonecopy" name="nullid" class="Hide">
										
													<foreach name='Zone' item='vz'>
														<option value="{$vz.zone_id}" zone_id="{$vz.zone_id}" city_id="{$vz.city_id}"  class="cityCopy">{$vz.zone_name}</option>
													</foreach>									
												</select>
											</div>
											<div class="form-block">
												<span class="label">地理坐标：</span>
												<p>请点击地图拾取坐标，当前坐标：(<span id="x-value">0</span>,<span id="y-value">0</span>)</p>
												<div id="allmap" class="img map"></div>												
											</div>
											
											<div class="form-block">
												<span class="label">封面上传：</span>		

												
												<input name="img[]" type="file" id="up0" onchange="viewmypic(showimg,this.form.up0);"/>(推荐大小 350*200)																					
											</div>
											
											<div class="form-block">
												<if condition="$pageType eq 'edit'">
													<img name="img0" src="/copydp/Public/uploads/img/{$seller.img}" alt="请上传活动封面" style="margin-left:90px;height:200px;width:350px;" id="img0">
												<else/>
											
												</if>											
																							
											</div> 	
											
											<div class="form-block">
												<span class="label">详细描述：</span>									
											</div>  
											<div class="form-block" style="margin-left: 85px;">
												<textarea id="info-text" name="info" class="Hide" value=""></textarea>
												<script id="editor" type="text/plain" class="form-default" style="width: 500px;">
												</script>									
											</div>  	
									 </div><!--表单内容-->
								 <!--提交区域-->
									<div class="block form-btn-block form-block form-content-block">							
										<strong class="btn-type-b btn-fn-c">
										
											<input name="editSellerID" type="hidden" value="{$seller.user_id}" class="Hide"/>
										
											<input id="btnAdd" type="button" value="提交审批" class="Hide"/>

											<input id="position" name="position" type="hidden" class="Hide"/>
											<button type="button" class="form-btn submit-btn">提交审批</button>
										</strong> 
									</div><!--提交区域-->
								</div>
							</div>		
						</div><!--表单-->				
				</form>	
            </div><!---产品信息编辑--->
		</div>
	</div><!---中间主要内容--->
</div><!---主页面---->

	<!---footer-->
		<include file="./Home/Tpl/Public/footer.html"/>
	<!---footer-->
	
	
	<div class="Hide">
		<!---城市坐标--->
		<foreach name='city' item='vc'>
			<p id="city_{$vc.city_id}" city="{$vc.city}"  x="{$vc.x}" y="{$vc.y}"></p>
		</foreach>	
		<p id ="pageType" data="{$pageType}"></p>
		<?php
			$typeDB=M('product_type');
			$tpyeIDCondition['type_id']=$seller['type_id'];
			$type = $typeDB->where($tpyeIDCondition)->find();
		?>		
		<p id = "SellerType" type_id="{$type.type_id}" father_id ="{$type.father_id}"></p>
		<p id = "SellerCity" city_id="{$seller.city_id}" zone_id ="{$seller.zone_id}"></p>
		<?php
			$info=$seller['info'];
			$info=str_replace("\\", '', $info);
		?>
		<div id ="html-info">{$info}</div>
		<p id = "action-eidt"  action="__URL__/edit" ></p>
	<div>
	
	<script type="text/javascript" src="__PUBLIC__/js/jquery-1.11.1.min.js"></script>
    <script type="text/javascript" charset="utf-8" src="__PUBLIC__/ueditor/umeditor.config.js"></script>
    <script type="text/javascript" charset="utf-8" src="__PUBLIC__/ueditor/umeditor.min.js"> </script>
    <script type="text/javascript" charset="utf-8" src="__PUBLIC__/ueditor/lang/zh-cn/zh-cn.js"></script>	
	<script type="text/javascript">	
	
	function typeSelectChange(){
		var id=$(".selectTarget").val();	
		
		$(".showOption").each(function(){	
			$(this).remove();
		});
		
		$(".typeCopy").each(function(){
			var fatherID=$(this).attr("father_id");
			var typeID=$(this).attr("type_id");
			var name=$(this).html();
			if(fatherID==id){				
				$("#typeSelect").append(
					"<option class='showOption' value='"+typeID+"'>"+name +"</option>"
				); 
			}
		});
	}
	function citySelectChange(){
		var id=$("#citySelect").val();
		
		
			
			
		$(".cityshowOption").each(function(){	
			$(this).remove();
		});
		
		$(".cityCopy").each(function(){
			var city_id=$(this).attr("city_id");
			var zone_id=$(this).attr("zone_id");
			var name=$(this).html();
			
			if(city_id==id){				
				$("#zoneSelect").append(
					
					'<option class="cityshowOption" value="'+zone_id+'">'+name +'</option>'
				); 
			}
			
		});
		//地图组件重新加载
			var x=$("#city_"+id).attr("x");
			var y=$("#city_"+id).attr("y");
			// 百度地图API功能	
			var map = new BMap.Map("allmap");    // 创建Map实例
			
			map.addEventListener("click",function(e){
				$("#y-value").html(e.point.lat);
				$("#x-value").html(e.point.lng);
				var position=e.point.lng+","+e.point.lat;
				$("#position").val(position);
			});
			
			var top_left_control = new BMap.ScaleControl({anchor: BMAP_ANCHOR_TOP_LEFT});// 左上角，添加比例尺
			var top_left_navigation = new BMap.NavigationControl();  //左上角，添加默认缩放平移控件
			var top_right_navigation = new BMap.NavigationControl({anchor: BMAP_ANCHOR_TOP_RIGHT, type: BMAP_NAVIGATION_CONTROL_SMALL}); //右上角，仅包含平移和缩放按钮
			map.addControl(top_left_control);        
			map.addControl(top_left_navigation);     
			map.addControl(top_right_navigation);    
			
			map.centerAndZoom(new BMap.Point(x,y), 11);  // 初始化地图,设置中心点坐标和地图级别
			map.setCurrentCity(city);          // 设置地图显示的城市 此项是必须设置	
	
	}
	
	  //实例化编辑器
    //建议使用工厂方法getEditor创建和引用编辑器实例，如果在某个闭包下引用该编辑器，直接调用UE.getEditor('editor')就能拿到相关的实例
		var um = UM.getEditor('editor');

		um.setContent($('#html-info').html());
		
		$(".submit-btn").click(function(){
			
			
			$("#info-text").val(UM.getEditor('editor').getContent());	
			
			var type=$('#pageType').attr('data');
			
			if(type=="edit"){
				var editurl=$("#action-eidt").attr("action");
				$("#addForm").attr("action",editurl);
				$("#addForm").submit();
			}else{
		
				$("#addForm").submit();
			}
			
			
		});

		
	</script>
	
	<script>
	//类别联动
		$('.type-select').change(function(){	
			$(".type-suboption").addClass("Hide");
			var type_id=$(".type-select").val();
			$(".typeGroup"+type_id).removeClass("Hide");
		});
    </script>
	
	<script>
        $(function () {
            $("#up0").uploadPreview({ Img: "img0"});				
        });
    </script>
	
	<script>
		//初始化
		 $(function () {
			if($('#pageType').attr('data')=="edit"){
				//初始化类型
					var id =$('#SellerType').attr('type_id');
					var father_id=$('#SellerType').attr('father_id');
					
					if(father_id != 0){					
						$(".type-suboption").addClass("Hide");
						$(".typeGroup"+father_id).removeClass("Hide");
						$(".typeid"+id).attr("selected",true);					
					}			
					//选中
					$(".fathertype"+father_id).attr("selected",true);
				//初始化城市
					var cityid =$('#SellerCity').attr('city_id');
					var zoneid=$('#SellerCity').attr('zone_id');
					
					$(".city-option").addClass("Hide");
					$(".cityid"+cityid).attr("selected",true);
					$("[data='"+cityid+"']").removeClass("Hide");				
					$(".zoneid"+zoneid).attr("selected",true);
					
					
					
			//地图组件重新加载
			var x=$("#city_"+cityid).attr("x");
			var y=$("#city_"+cityid).attr("y");
			// 百度地图API功能	
			var map = new BMap.Map("allmap");    // 创建Map实例
			
			map.addEventListener("click",function(e){
				$("#y-value").html(e.point.lat);
				$("#x-value").html(e.point.lng);
				var position=e.point.lng+","+e.point.lat;
				$("#position").val(position);
			});
			
			var top_left_control = new BMap.ScaleControl({anchor: BMAP_ANCHOR_TOP_LEFT});// 左上角，添加比例尺
			var top_left_navigation = new BMap.NavigationControl();  //左上角，添加默认缩放平移控件
			var top_right_navigation = new BMap.NavigationControl({anchor: BMAP_ANCHOR_TOP_RIGHT, type: BMAP_NAVIGATION_CONTROL_SMALL}); //右上角，仅包含平移和缩放按钮
			map.addControl(top_left_control);        
			map.addControl(top_left_navigation);     
			map.addControl(top_right_navigation);    
			
			map.centerAndZoom(new BMap.Point(x,y), 11);  // 初始化地图,设置中心点坐标和地图级别
			
			}
        });
		
    </script>
</body>
</html>
